<!DOCTYPE html>
<html>
<head>
    <title>Test User Flow</title>
</head>
<body>
    <h1>Test User Flow</h1>
    <div id="output"></div>
    
    <script>
        const API_BASE = 'https://h8iyzk1h3k.execute-api.us-east-1.amazonaws.com';
        
        async function testUserFlow() {
            const output = document.getElementById('output');
            
            // Simulate a real user ID (like from Cognito)
            const testUserId = 'test-user-' + Date.now();
            
            output.innerHTML += `<p><strong>Testing with User ID:</strong> ${testUserId}</p>`;
            
            // Step 1: Send some concerning messages
            const concerningMessages = [
                "I feel hopeless today",
                "I don't see the point in anything anymore", 
                "Sometimes I wish I could just disappear"
            ];
            
            output.innerHTML += `<p><strong>Step 1:</strong> Sending concerning messages...</p>`;
            
            for (const message of concerningMessages) {
                try {
                    const response = await fetch(`${API_BASE}/agent-chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userId: testUserId,
                            message: message,
                            sessionId: `${testUserId}-test`
                        })
                    });
                    
                    if (response.ok) {
                        output.innerHTML += `<p>✅ Sent: "${message}"</p>`;
                    } else {
                        output.innerHTML += `<p>❌ Failed to send: "${message}"</p>`;
                    }
                } catch (error) {
                    output.innerHTML += `<p>❌ Error sending: "${message}" - ${error.message}</p>`;
                }
                
                // Wait a bit between messages
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            // Step 2: Calculate risk score
            output.innerHTML += `<p><strong>Step 2:</strong> Calculating risk score...</p>`;
            
            try {
                const riskResponse = await fetch(`${API_BASE}/calculate-risk`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: testUserId })
                });
                
                if (riskResponse.ok) {
                    const riskData = await riskResponse.json();
                    output.innerHTML += `<p><strong>Risk Assessment Results:</strong></p>`;
                    output.innerHTML += `<pre>${JSON.stringify(riskData, null, 2)}</pre>`;
                } else {
                    const errorText = await riskResponse.text();
                    output.innerHTML += `<p>❌ Risk calculation failed: ${errorText}</p>`;
                }
            } catch (error) {
                output.innerHTML += `<p>❌ Risk calculation error: ${error.message}</p>`;
            }
        }
        
        // Run the test
        testUserFlow();
    </script>
</body>
</html>